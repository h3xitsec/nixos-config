# Pentest shell environment with security testing tools
# Usage: Run 'penteshell' to enter the environment
{pkgs, ...}: let
  pentestPackages = with pkgs; [
    # Network scanning & analysis
    nmap
    masscan
    tcpdump
    wireshark-cli
    iperf3
    netcat
    socat
    arp-scan

    # Web application testing
    sqlmap
    nikto
    gobuster
    dirb
    wfuzz
    whatweb

    # Password cracking & brute force
    thc-hydra
    john
    hashcat
    #medusa

    # Wireless
    aircrack-ng
    wifite2

    # Proxy & MITM
    mitmproxy
    bettercap
    proxychains-ng

    # Reconnaissance
    theharvester
    recon-ng
    dnsenum

    # Binary analysis & reverse engineering
    radare2
    ltrace

    # Forensics & steganography
    exiftool
    steghide
    binwalk
    foremost

    # SMB enumeration
    smbmap
    enum4linux

    # Scripting
    python3
    python3Packages.scapy
  ];

  pentestEnv = pkgs.buildEnv {
    name = "pentest-env";
    paths = pentestPackages;
  };

  pentestShell = pkgs.writeShellScriptBin "pentestshell" ''
    echo "=========================================="
    echo " Pentest Shell"
    echo " Location  : $PWD"
    echo " Tools     : nmap, masscan, sqlmap, hydra, john, etc."
    echo "=========================================="
    export PENTEST_HOME="$HOME/.pentest"
    mkdir -p "$PENTEST_HOME"
    export PATH="${pentestEnv}/bin:$PATH"
    exec bash
  '';
in {
  home.packages = [pentestShell];
}
